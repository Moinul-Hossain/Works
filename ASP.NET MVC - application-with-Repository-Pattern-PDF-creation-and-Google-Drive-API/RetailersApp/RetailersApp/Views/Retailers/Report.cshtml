@model IEnumerable<RetailersApp.ViewModels.RetailerViewModel>

@{
    ViewBag.Title = "Master Details GridView (LINQ)";
}

<h2>Master Details GridView (LINQ)</h2>

<p>
    @Html.ActionLink("Retailers", "Index") | @Html.ActionLink("Departments", "../Departments/Index")
</p>

<table class="table">
    <tr>
        <!--th>
        @{
            //Html.DisplayNameFor(model => model.RetailerID)
        }
        </th-->

        <th><input type="checkbox" id="chkAll" /></th>

        <th>
            Retailer Name
        </th>
        <th>
            Retailer Code
        </th>

        <th>
            Retailer Location
        </th>
        <th>
            Department Name
        </th>
        <th>
            Department Code
        </th>

    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td><input type="checkbox" /></td>

            <td>
                @Html.DisplayFor(modelItem => item.RetailerName)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.RetailerCode)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.RetailerLocation)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.DepartmentName)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.DepartmentCode)
            </td>

        </tr>
    }

</table>

<div class="col-sm-2">
    <button class="btn btn-primary form-control" id="btnPdf">Export to PDF</button>
</div>
<div class="col-sm-2">
    <button class="btn btn-primary form-control" id="btnExcel">Export to Excel</button>
</div>
<!--
<div class="col-sm-3">
    <button class="btn btn-primary form-control" id="btnGSheet">Export to Google Spreadsheet</button>
</div>
-->

<div class="col-sm-3">
    <button class="btn btn-primary form-control" id="btnGdrive">Export PDF to Google Drive</button>
</div>
<p>&nbsp;</p>

@using (Html.BeginForm("ExportPdf", "Retailers", FormMethod.Post))
{
    @Html.Hidden("content")
}

<script src="@Url.Content("~/Scripts/jquery-1.10.2.min.js")" type="text/javascript"></script>

<script>

    $("#chkAll").click(function () {
        if (this.checked) {
            $('input:checkbox').not(this).prop('checked', this.checked); //$('#keepSelected').removeClass('btn disabled');
        }
        else {
            $('input:checkbox').not(this).prop('checked', ''); //$('#keepSelected').addClass('btn disabled');
        }
    });

    $('input:checkbox').not($('#chkAll')).click(function () {
        $('#chkAll').prop('checked', '');
    });

    $('#btnPdf').click(function () {
        var pdfcontent = getContent();
        $('#content').val(pdfcontent);
        document.forms[0].action = "../Retailers/ExportPdf";
        document.forms[0].submit();
    });

    $('#btnExcel').click(function () {
        var content = getContent();
        $('#content').val(content);
        document.forms[0].action = "../Retailers/ExportExcel";
        document.forms[0].submit();
    });

    $('#btnGdrive').click(function () {
        var content = getContent();
        $('#content').val(content);
        document.forms[0].action = "http://localhost:5000/Retailers/ExportGdrive";
        document.forms[0].submit();
    });

    function getContent() {
        var content = ""; ///"<style>th{border-bottom: 1px solid #ff0000;}</style>";
        content += "<h1>Master Details GridView (LINQ)</h1>";
        content += "<table border=\"0\" cellpadding=\"5\" cellspacing=\"0\" width=\"95%\">";

        content += "<tr>";
        content += "<th style=\"border-bottom: 1px solid #ff0000;\">Retailer Name</th>";
        content += "<th style=\"border-bottom: 1px solid #ff0000;\">";
        content += "Retailer Code";
        content += "</th>";
        content += "<th style=\"border-bottom: 1px solid #ff0000;\">";
        content += "Retailer Location";
        content += "</th>";
        content += "<th style=\"border-bottom: 1px solid #ff0000;\">";
        content += "Department Name";
        content += "</th>";
        content += "<th style=\"border-bottom: 1px solid #ff0000;\">";
        content += "Department Code";
        content += "</th>";
        content += "</tr>";

        $('input:checkbox:checked').not($('#chkAll')).parents("tr").each(function () {
            var td = $(this).find("td:first");
            $(this).find("td:first").remove();
            content += "<tr>";
            content += $(this).html();
            content += "</tr>";
            $(this).prepend("<td>" + td.html() + "</td>");
        });

        content += "</table>";
        console.log(content);
        $('#chkAll').prop('checked', '');
        return content;
    }

</script>
